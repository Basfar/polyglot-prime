<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SwaggerConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TechBD Hub (Prime)</a> &gt; <a href="index.source.html" class="el_package">org.techbd.service.http</a> &gt; <span class="el_source">SwaggerConfig.java</span></div><h1>SwaggerConfig.java</h1><pre class="source lang-java linenums">package org.techbd.service.http;

import org.springdoc.core.customizers.OperationCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.method.HandlerMethod;
import org.techbd.service.http.hub.prime.AppConfig;

import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.models.ExternalDocumentation;
import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.Operation;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.info.License;
import io.swagger.v3.oas.models.media.StringSchema;
import io.swagger.v3.oas.models.parameters.Parameter;

@Configuration
public class SwaggerConfig {
    private final AppConfig appConfig;

<span class="nc" id="L22">    public SwaggerConfig(final AppConfig appConfig) {</span>
<span class="nc" id="L23">        this.appConfig = appConfig;</span>
<span class="nc" id="L24">    }</span>

    @Bean
    public OpenAPI springOpenAPI() {
<span class="nc" id="L28">        return new OpenAPI()</span>
<span class="nc" id="L29">                .info(new Info().title(&quot;TechBD FHIR Server&quot;)</span>
<span class="nc" id="L30">                        .description(&quot;Public REST API Endpoints&quot;).version(appConfig.getVersion())</span>
<span class="nc" id="L31">                        .license(new License().name(&quot;GitHub Repository&quot;)</span>
<span class="nc" id="L32">                                .url(&quot;https://github.com/tech-by-design/polyglot-prime&quot;)))</span>
<span class="nc" id="L33">                .externalDocs(new ExternalDocumentation().description(&quot;TechBD Technical Documents Microsite&quot;)</span>
<span class="nc" id="L34">                        .url(&quot;https://tech-by-design.github.io/docs.techbd.org/&quot;));</span>
    }

    @Bean
    public OperationCustomizer customGlobalHeaders() {

<span class="nc" id="L40">        return (Operation operation, HandlerMethod handlerMethod) -&gt; {</span>

<span class="nc" id="L42">            final var interactionPersistStrategy = new Parameter()</span>
<span class="nc" id="L43">                    .in(ParameterIn.HEADER.toString())</span>
<span class="nc" id="L44">                    .schema(new StringSchema())</span>
<span class="nc" id="L45">                    .name(Interactions.Servlet.HeaderName.Request.PERSISTENCE_STRATEGY)</span>
<span class="nc" id="L46">                    .description(String.format(</span>
                            &quot;&quot;&quot;
                                    Instructs servlet to serialize full HTTP request/response and store it in memory, file system, SFTP, BlobStore, etc.
                                    Based on which strategy is chosen, the Response Headers will include `%s*` values. The header value may be either a single
                                    object or an array of objects (if multiple persistence strategies are desired).

                                    - Default: `{ &quot;nature&quot;: &quot;diagnostics&quot; }`
                                    - File system: `{ &quot;nature&quot;: &quot;fs&quot;, &quot;fsPath&quot;: &quot;${cwd()}/TECHBD_INTERACTIONS/${formattedDateNow('yyyy/MM/dd/HH')}/${artifactId}.json&quot; }`
                                    - VFS TempFS: `{ &quot;nature&quot;: &quot;vfs&quot;, &quot;vfsUri&quot;: &quot;tmp://techbd.org/interaction-artifacts/${formattedDateNow('yyyy/MM/dd/HH')}/${artifactId}.json&quot; }`
                                    - Email: `{ &quot;nature&quot;: &quot;email&quot;, &quot;from&quot;: &quot;support@techbd.org&quot;, &quot;to&quot;: &quot;toroj11859@qiradio.com&quot;, &quot;subject&quot;: &quot;test FHIR email&quot; }`
                                    - DuckDB Local: `{ &quot;nature&quot;: &quot;duckdb&quot; }`
                                    - DuckDB: `{ &quot;nature&quot;: &quot;duckdb&quot;, &quot;motherDuck&quot;: { &quot;db&quot;: &quot;interactions&quot;, &quot;token&quot;: &quot;${env('MOTHERDUCK_TOKEN')}&quot; } }`
                                    - PostgreSQL: `{ &quot;nature&quot;: &quot;postgres&quot;, &quot;url&quot;: &quot;jdbc:postgresql://2.aws.neon.tech/persistence?user=${env('USER')}&amp;password=${env('PASSWD')}&amp;sslmode=require&quot; }`
                                    - VFS SFTP: `{ &quot;nature&quot;: &quot;vfs&quot;, &quot;vfsUri&quot;: &quot;sftp://*****:******@sftp.example.com:22/log/synthetic.fhir.api.techbd.org/{{TECH_BD_FHIR_SERVICE_QE_IDENTIFIER}}/interaction-artifacts/${formattedDateNow('yyyy/MM/dd/HH')}/${artifactId}.json&quot; }`
                                    - BlobStore: TODO `{ &quot;nature&quot;: &quot;aws-s3&quot;, &quot;arg1&quot;: 1, &quot;arg2&quot;: 2 }`
                                    - Aggregated: `[{ ... first ... }, { ... second ... }]`

                                    ${cwd()} refers to current working directory (CWD) on the API server, ${artifactId} refers to the `interactionId`.
                                    &quot;&quot;&quot;,
                            Interactions.Servlet.HeaderName.PREFIX))
<span class="nc" id="L66">                    .required(false);</span>

<span class="nc" id="L68">                final var interactionProvenance = new Parameter()</span>
<span class="nc" id="L69">                    .in(ParameterIn.HEADER.toString())</span>
<span class="nc" id="L70">                    .schema(new StringSchema())</span>
<span class="nc" id="L71">                    .name(Interactions.Servlet.HeaderName.Request.PROVENANCE)</span>
<span class="nc" id="L72">                    .description(String.format(</span>
                            &quot;&quot;&quot;
                                    Instructs servlet to send a &quot;provenance&quot; JSON object for tracking in database.
                                    Something like this (as long as it's a JSON object, the content is arbitrary):

                                    - { &quot;nature&quot;: &quot;integration-test&quot;, &quot;test-case&quot;: &quot;fhir-fixture-shinny-impl-guide-sample.json&quot; }
                                    - { &quot;nature&quot;: &quot;synthetic-scoring&quot;, &quot;test-case&quot;: &quot;qe-001&quot; }
                                    &quot;&quot;&quot;,
                            Interactions.Servlet.HeaderName.PREFIX))
<span class="nc" id="L81">                    .required(false);</span>

<span class="nc" id="L83">            operation.addParametersItem(interactionPersistStrategy);</span>
<span class="nc" id="L84">            operation.addParametersItem(interactionProvenance);</span>
<span class="nc" id="L85">            return operation;</span>
        };
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>