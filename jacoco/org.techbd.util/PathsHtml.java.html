<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PathsHtml.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TechBD Hub (Prime)</a> &gt; <a href="index.source.html" class="el_package">org.techbd.util</a> &gt; <span class="el_source">PathsHtml.java</span></div><h1>PathsHtml.java</h1><pre class="source lang-java linenums">package org.techbd.util;

import java.util.Map;
import java.util.Optional;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * This class provides HTML representation utilities for the Paths class.
 */
public class PathsHtml&lt;C, P&gt; {

    private final Optional&lt;Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt;&gt; leafNodeHtmlContent;
    private final Optional&lt;Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt;&gt; parentNodeHtmlContent;
    private final Optional&lt;Function&lt;Paths&lt;C, P&gt;.Node, String&gt;&gt; htmlFriendlyId;
    private final String lineIndent;
    private final String tagIndent;

<span class="fc" id="L19">    private static final HtmlContent DEFAULT_HTML_CONTENT = new HtmlContent(</span>
<span class="fc" id="L20">            Optional.empty(),</span>
<span class="fc" id="L21">            Optional.of(Map.of(&quot;style&quot;, &quot;text-indent: -1em; padding-left: 1em;&quot;)),</span>
<span class="fc" id="L22">            Optional.of(Map.of(&quot;class&quot;, &quot;cursor-pointer font-semibold&quot;)),</span>
<span class="fc" id="L23">            Optional.empty(),</span>
<span class="fc" id="L24">            Optional.empty());</span>

<span class="fc" id="L26">    private PathsHtml(final Builder&lt;C, P&gt; builder) {</span>
<span class="fc" id="L27">        this.leafNodeHtmlContent = Optional.ofNullable(builder.leafNodeHtmlContent);</span>
<span class="fc" id="L28">        this.parentNodeHtmlContent = Optional.ofNullable(builder.parentNodeHtmlContent);</span>
<span class="fc" id="L29">        this.htmlFriendlyId = builder.htmlFriendlyId;</span>
<span class="fc" id="L30">        this.lineIndent = builder.lineIndent;</span>
<span class="fc" id="L31">        this.tagIndent = builder.tagIndent;</span>
<span class="fc" id="L32">    }</span>

    /**
     * Generates an HTML representation of the given Paths object wrapped in a
     * &lt;ul&gt;
     *
     * @param paths the Paths object to visualize
     * @return a string representing the HTML tree
     */
    public String toHtmlUL(final Paths&lt;C, P&gt; paths, Optional&lt;Map&lt;String, String&gt;&gt; ulAttrs) {
<span class="fc" id="L42">        var sb = new StringBuilder();</span>
<span class="fc" id="L43">        sb.append(lineIndent).append(&quot;&lt;ul&quot;)</span>
<span class="fc" id="L44">                .append(ulAttrs.map(this::mapToAttributes).orElse(&quot;&quot;))</span>
<span class="fc" id="L45">                .append(&quot;&gt;&quot;);</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">        for (var root : paths.roots()) {</span>
<span class="fc" id="L47">            appendNode(sb, root, 0, true);</span>
<span class="fc" id="L48">        }</span>
<span class="fc" id="L49">        sb.append(lineIndent).append(&quot;&lt;/ul&gt;&quot;);</span>
<span class="fc" id="L50">        return sb.toString();</span>
    }

    /**
     * Appends a node and its children to the StringBuilder with the appropriate
     * HTML structure.
     *
     * @param sb          the StringBuilder to append to
     * @param node        the current node to append
     * @param level       the current level in the tree
     * @param isFirstNode indicates if the node is the first node to avoid starting
     *                    with a blank line
     */
    private void appendNode(final StringBuilder sb, final Paths&lt;C, P&gt;.Node node, final int level,
            final boolean isFirstNode) {
<span class="fc" id="L65">        final boolean isLeaf = node.isLeaf();</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">        final var content = isLeaf</span>
<span class="pc" id="L67">                ? leafNodeHtmlContent.flatMap(func -&gt; Optional.ofNullable(func.apply(node)))</span>
<span class="fc" id="L68">                        .orElse(DEFAULT_HTML_CONTENT)</span>
<span class="pc" id="L69">                : parentNodeHtmlContent.flatMap(func -&gt; Optional.ofNullable(func.apply(node)))</span>
<span class="fc" id="L70">                        .orElse(DEFAULT_HTML_CONTENT);</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">        final var label = content.labelHtml().orElse(isLeaf ? &quot;ðŸ“„ &quot; + getDefaultLabel(node) : getDefaultLabel(node));</span>
<span class="fc" id="L72">        final var liAttrs = content.liAttrs().map(this::mapToAttributes).orElse(&quot;&quot;);</span>
<span class="fc" id="L73">        final var detailsAttrs = content.detailsAttrs().map(this::mapToAttributes).orElse(&quot;&quot;);</span>
<span class="fc" id="L74">        final var summaryAttrs = content.summaryAttrs().map(this::mapToAttributes).orElse(&quot;&quot;);</span>

<span class="fc bfc" id="L76" title="All 2 branches covered.">        if (!isFirstNode) {</span>
<span class="fc" id="L77">            sb.append(&quot;\n&quot;).append(lineIndent).append(tagIndent.repeat(level));</span>
        }

<span class="fc" id="L80">        sb.append(&quot;&lt;li&quot;);</span>
<span class="fc" id="L81">        htmlFriendlyId.ifPresent(idFunc -&gt; sb.append(&quot; &quot;).append(idFunc.apply(node)));</span>
<span class="fc" id="L82">        sb.append(liAttrs).append(&quot;&gt;&quot;);</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">        if (!isLeaf) {</span>
<span class="fc" id="L84">            sb.append(&quot;&lt;details&quot;).append(detailsAttrs).append(&quot;&gt;&quot;);</span>
<span class="fc" id="L85">            sb.append(&quot;&lt;summary&quot;).append(summaryAttrs).append(&quot;&gt;&quot;).append(label).append(&quot;&lt;/summary&gt;&quot;);</span>
<span class="fc" id="L86">            sb.append(&quot;\n&quot;).append(lineIndent).append(tagIndent.repeat(level + 1)).append(&quot;&lt;ul&gt;&quot;);</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            for (var child : node.children()) {</span>
<span class="fc" id="L88">                appendNode(sb, child, level + 1, false);</span>
<span class="fc" id="L89">            }</span>
<span class="fc" id="L90">            sb.append(&quot;\n&quot;).append(lineIndent).append(tagIndent.repeat(level)).append(&quot;&lt;/ul&gt;&quot;);</span>
<span class="fc" id="L91">            sb.append(&quot;&lt;/details&gt;&quot;);</span>
        } else {
<span class="fc" id="L93">            sb.append(label);</span>
        }
<span class="fc" id="L95">        sb.append(&quot;&lt;/li&gt;&quot;);</span>
<span class="fc" id="L96">    }</span>

    /**
     * Converts a map of attributes to a string representation, properly escaping
     * the attribute values.
     *
     * @param attributes the map of attributes
     * @return the string representation of the attributes
     */
    private String mapToAttributes(final Map&lt;String, String&gt; attributes) {
<span class="fc" id="L106">        return attributes.entrySet().stream()</span>
<span class="fc" id="L107">                .map(entry -&gt; &quot; &quot; + entry.getKey() + &quot;=\&quot;&quot; + escapeHtml(entry.getValue()) + &quot;\&quot;&quot;)</span>
<span class="fc" id="L108">                .collect(Collectors.joining());</span>
    }

    /**
     * Escapes HTML special characters in a string.
     *
     * @param text the input string
     * @return the escaped string
     */
    private String escapeHtml(final String text) {
<span class="fc" id="L118">        return text.replace(&quot;&amp;&quot;, &quot;&amp;amp;&quot;)</span>
<span class="fc" id="L119">                .replace(&quot;&lt;&quot;, &quot;&amp;lt;&quot;)</span>
<span class="fc" id="L120">                .replace(&quot;&gt;&quot;, &quot;&amp;gt;&quot;)</span>
<span class="fc" id="L121">                .replace(&quot;\&quot;&quot;, &quot;&amp;quot;&quot;)</span>
<span class="fc" id="L122">                .replace(&quot;'&quot;, &quot;&amp;#39;&quot;);</span>
    }

    /**
     * Returns the default label for a node.
     *
     * @param node the node
     * @return the default label
     */
    private String getDefaultLabel(final Paths&lt;C, P&gt;.Node node) {
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">        return node.components().isEmpty() ? &quot;&quot; : node.components().get(node.components().size() - 1).toString();</span>
    }

    /**
     * Builder class to configure and create an instance of PathsHtml.
     */
    public static class Builder&lt;C, P&gt; {
<span class="fc" id="L139">        private Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt; leafNodeHtmlContent = null;</span>
<span class="fc" id="L140">        private Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt; parentNodeHtmlContent = null;</span>
<span class="fc" id="L141">        private Optional&lt;Function&lt;Paths&lt;C, P&gt;.Node, String&gt;&gt; htmlFriendlyId = Optional.empty();</span>
<span class="fc" id="L142">        private String lineIndent = &quot;&quot;;</span>
<span class="fc" id="L143">        private String tagIndent = &quot;  &quot;;</span>

<span class="fc" id="L145">        public Builder() {</span>
<span class="fc" id="L146">        }</span>

        /**
         * Sets the function to generate HtmlContent for leaf nodes.
         *
         * @param leafNodeHtmlContent the function to generate HtmlContent for leaf
         *                            nodes
         * @return the Builder instance
         */
        public Builder&lt;C, P&gt; leafNodeHtmlContent(final Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt; leafNodeHtmlContent) {
<span class="nc" id="L156">            this.leafNodeHtmlContent = leafNodeHtmlContent;</span>
<span class="nc" id="L157">            return this;</span>
        }

        /**
         * Sets the function to generate HtmlContent for parent nodes.
         *
         * @param parentNodeHtmlContent the function to generate HtmlContent for parent
         *                              nodes
         * @return the Builder instance
         */
        public Builder&lt;C, P&gt; parentNodeHtmlContent(
                final Function&lt;Paths&lt;C, P&gt;.Node, HtmlContent&gt; parentNodeHtmlContent) {
<span class="nc" id="L169">            this.parentNodeHtmlContent = parentNodeHtmlContent;</span>
<span class="nc" id="L170">            return this;</span>
        }

        /**
         * Sets the function to generate HTML-friendly IDs.
         *
         * @param htmlFriendlyId the function to generate HTML-friendly IDs
         * @return the Builder instance
         */
        public Builder&lt;C, P&gt; withIds(final Function&lt;Paths&lt;C, P&gt;.Node, String&gt; htmlFriendlyId) {
<span class="fc" id="L180">            this.htmlFriendlyId = Optional.ofNullable(htmlFriendlyId);</span>
<span class="fc" id="L181">            return this;</span>
        }

        /**
         * Sets the line indentation.
         *
         * @param indent the line indentation string
         * @return the Builder instance
         */
        public Builder&lt;C, P&gt; indentLines(final String indent) {
<span class="nc" id="L191">            this.lineIndent = Optional.ofNullable(indent).orElse(&quot;&quot;);</span>
<span class="nc" id="L192">            return this;</span>
        }

        /**
         * Sets the tag indentation.
         *
         * @param indent the tag indentation string
         * @return the Builder instance
         */
        public Builder&lt;C, P&gt; indentTags(final String indent) {
<span class="nc" id="L202">            this.tagIndent = Optional.ofNullable(indent).orElse(&quot;  &quot;);</span>
<span class="nc" id="L203">            return this;</span>
        }

        /**
         * Builds the PathsHtml instance.
         *
         * @return the PathsHtml instance
         */
        public PathsHtml&lt;C, P&gt; build() {
<span class="fc" id="L212">            return new PathsHtml&lt;&gt;(this);</span>
        }
    }

    /**
     * Record to hold HTML content details.
     */
    public record HtmlContent(Optional&lt;String&gt; labelHtml, Optional&lt;Map&lt;String, String&gt;&gt; liAttrs,
            Optional&lt;Map&lt;String, String&gt;&gt; detailsAttrs, Optional&lt;Map&lt;String, String&gt;&gt; summaryAttrs,
            Optional&lt;Map&lt;String, String&gt;&gt; anchorAttrs) {
        /**
         * Constructor for HtmlContent record.
         *
         * @param labelHtml    the HTML content for the label
         * @param liAttrs      the attributes for the
         *                     &lt;li&gt;tag
         * @param detailsAttrs the attributes for the &lt;details&gt; tag
         * @param summaryAttrs the attributes for the &lt;summary&gt; tag
         * @param anchorAttrs  the attributes for the &lt;a&gt; tag
         */
<span class="fc" id="L232">        public HtmlContent {</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">            if (labelHtml == null)</span>
<span class="nc" id="L234">                labelHtml = Optional.empty();</span>
<span class="pc bpc" id="L235" title="1 of 2 branches missed.">            if (liAttrs == null)</span>
<span class="nc" id="L236">                liAttrs = Optional.empty();</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">            if (detailsAttrs == null)</span>
<span class="nc" id="L238">                detailsAttrs = Optional.empty();</span>
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">            if (summaryAttrs == null)</span>
<span class="nc" id="L240">                summaryAttrs = Optional.empty();</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">            if (anchorAttrs == null)</span>
<span class="nc" id="L242">                anchorAttrs = Optional.empty();</span>
<span class="fc" id="L243">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>